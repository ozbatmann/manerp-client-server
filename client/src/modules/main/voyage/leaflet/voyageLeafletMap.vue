<template>
    <div id="voyage_map"></div>
</template>
<!--TODO: use marker cluster in the future-->
<script>
    import L from 'leaflet'
    import 'leaflet/dist/leaflet.css'

    export default {
        name: "leafletMap",
        data() {
            return {
                map: null,
                currentMarker: null,
                tileLayer: null,
                greenMarker: null,
                blackMarker: null,
                tileType: 'mapbox.streets-basic',
                zoomLevel: 6,
                layers: [
                    {id: 0, name: 'Bayileri Göster', active: false},
                    {id: 1, name: 'Rotaları Göster', active: false}
                ],
                locations: [],
                waypointPolyline: null,
                waypoints: [
                    [
                        39.79799,
                        32.806089
                    ],
                    [
                        39.79811,
                        32.80607
                    ],
                    [
                        39.79829,
                        32.80603
                    ],
                    [
                        39.79839,
                        32.805999
                    ],
                    [
                        39.79844,
                        32.805929
                    ],
                    [
                        39.79851,
                        32.805819
                    ],
                    [
                        39.79859,
                        32.805799
                    ],
                    [
                        39.80641,
                        32.80404
                    ],
                    [
                        39.80803,
                        32.80361
                    ],
                    [
                        39.80955,
                        32.80293
                    ],
                    [
                        39.81085,
                        32.8022
                    ],
                    [
                        39.81101,
                        32.80209
                    ],
                    [
                        39.81629,
                        32.79808
                    ],
                    [
                        39.81699,
                        32.79764
                    ],
                    [
                        39.81714,
                        32.797559
                    ],
                    [
                        39.81816,
                        32.79713
                    ],
                    [
                        39.81917,
                        32.79688
                    ],
                    [
                        39.82687,
                        32.796
                    ],
                    [
                        39.82759,
                        32.796059
                    ],
                    [
                        39.82815,
                        32.7962
                    ],
                    [
                        39.83045,
                        32.79734
                    ],
                    [
                        39.83144,
                        32.79758
                    ],
                    [
                        39.83249,
                        32.79752
                    ],
                    [
                        39.83413,
                        32.79708
                    ],
                    [
                        39.83492,
                        32.7971
                    ],
                    [
                        39.83579,
                        32.79741
                    ],
                    [
                        39.83659,
                        32.798009
                    ],
                    [
                        39.84074,
                        32.8034
                    ],
                    [
                        39.84092,
                        32.8037
                    ],
                    [
                        39.84165,
                        32.80503
                    ],
                    [
                        39.84177,
                        32.80538
                    ],
                    [
                        39.84163,
                        32.806289
                    ],
                    [
                        39.84188,
                        32.807299
                    ],
                    [
                        39.84181,
                        32.80813
                    ],
                    [
                        39.84179,
                        32.80834
                    ],
                    [
                        39.84184,
                        32.80944
                    ],
                    [
                        39.84359,
                        32.8217
                    ],
                    [
                        39.84457,
                        32.825699
                    ],
                    [
                        39.8449,
                        32.82965
                    ],
                    [
                        39.84489,
                        32.8297
                    ],
                    [
                        39.84496,
                        32.82994
                    ],
                    [
                        39.84514,
                        32.829949
                    ],
                    [
                        39.84523,
                        32.829859
                    ],
                    [
                        39.84518,
                        32.829549
                    ],
                    [
                        39.84515,
                        32.829369
                    ],
                    [
                        39.84494,
                        32.82819
                    ],
                    [
                        39.84459,
                        32.82511
                    ],
                    [
                        39.84392,
                        32.82268
                    ],
                    [
                        39.84361,
                        32.82107
                    ],
                    [
                        39.84194,
                        32.80923
                    ],
                    [
                        39.84194,
                        32.808149
                    ],
                    [
                        39.84217,
                        32.80719
                    ],
                    [
                        39.84254,
                        32.80661
                    ],
                    [
                        39.8433,
                        32.80575
                    ],
                    [
                        39.84344,
                        32.805529
                    ],
                    [
                        39.84356,
                        32.8051
                    ],
                    [
                        39.84356,
                        32.80464
                    ],
                    [
                        39.84304,
                        32.80263
                    ],
                    [
                        39.84298,
                        32.80151
                    ],
                    [
                        39.844,
                        32.79735
                    ],
                    [
                        39.84447,
                        32.79511
                    ],
                    [
                        39.84505,
                        32.79329
                    ],
                    [
                        39.84513,
                        32.79282
                    ],
                    [
                        39.84513,
                        32.79247
                    ],
                    [
                        39.84497,
                        32.7918
                    ],
                    [
                        39.84465,
                        32.79083
                    ],
                    [
                        39.844,
                        32.789299
                    ],
                    [
                        39.84387,
                        32.78867
                    ],
                    [
                        39.84388,
                        32.78766
                    ],
                    [
                        39.84448,
                        32.78342
                    ],
                    [
                        39.84446,
                        32.782359
                    ],
                    [
                        39.84416,
                        32.78158
                    ],
                    [
                        39.84365,
                        32.78062
                    ],
                    [
                        39.83863,
                        32.773739
                    ],
                    [
                        39.83678,
                        32.77135
                    ],
                    [
                        39.83598,
                        32.77018
                    ],
                    [
                        39.83581,
                        32.76977
                    ],
                    [
                        39.83561,
                        32.7688
                    ],
                    [
                        39.83559,
                        32.76796
                    ],
                    [
                        39.83655,
                        32.76362
                    ],
                    [
                        39.83657,
                        32.76279
                    ],
                    [
                        39.83649,
                        32.7623
                    ],
                    [
                        39.83609,
                        32.76106
                    ],
                    [
                        39.83303,
                        32.7532
                    ],
                    [
                        39.82949,
                        32.74445
                    ],
                    [
                        39.8292,
                        32.743389
                    ],
                    [
                        39.82872,
                        32.74025
                    ],
                    [
                        39.8287,
                        32.73888
                    ],
                    [
                        39.82885,
                        32.73785
                    ],
                    [
                        39.8295,
                        32.73537
                    ],
                    [
                        39.82965,
                        32.73438
                    ],
                    [
                        39.82973,
                        32.73424
                    ],
                    [
                        39.83002,
                        32.73396
                    ],
                    [
                        39.83091,
                        32.733559
                    ],
                    [
                        39.83151,
                        32.73305
                    ],
                    [
                        39.83343,
                        32.731029
                    ],
                    [
                        39.83441,
                        32.72955
                    ],
                    [
                        39.83471,
                        32.72871
                    ],
                    [
                        39.84208,
                        32.71231
                    ],
                    [
                        39.84211,
                        32.7123
                    ],
                    [
                        39.84214,
                        32.71228
                    ],
                    [
                        39.84226,
                        32.71228
                    ],
                    [
                        39.8488,
                        32.7104
                    ],
                    [
                        39.85032,
                        32.71004
                    ],
                    [
                        39.85096,
                        32.71022
                    ],
                    [
                        39.85702,
                        32.71345
                    ],
                    [
                        39.85732,
                        32.71345
                    ],
                    [
                        39.86409,
                        32.71184
                    ],
                    [
                        39.8648,
                        32.71143
                    ],
                    [
                        39.86556,
                        32.710639
                    ],
                    [
                        39.86598,
                        32.71015
                    ],
                    [
                        39.86705,
                        32.708579
                    ],
                    [
                        39.8696,
                        32.70583
                    ],
                    [
                        39.87174,
                        32.702669
                    ],
                    [
                        39.87426,
                        32.70028
                    ],
                    [
                        39.87491,
                        32.69977
                    ],
                    [
                        39.87496,
                        32.69963
                    ],
                    [
                        39.87486,
                        32.69946
                    ],
                    [
                        39.87475,
                        32.699289
                    ],
                    [
                        39.873779999999996,
                        32.69731
                    ],
                    [
                        39.87342,
                        32.695659
                    ],
                    [
                        39.87361,
                        32.6937
                    ],
                    [
                        39.87409,
                        32.69041
                    ],
                    [
                        39.87396,
                        32.68775
                    ],
                    [
                        39.87395,
                        32.687669
                    ],
                    [
                        39.87388,
                        32.687089
                    ],
                    [
                        39.87409,
                        32.68469
                    ],
                    [
                        39.87572,
                        32.68083
                    ],
                    [
                        39.87629,
                        32.67993
                    ],
                    [
                        39.87862,
                        32.67721
                    ],
                    [
                        39.8787,
                        32.6771
                    ],
                    [
                        39.88051,
                        32.675669
                    ],
                    [
                        39.88078,
                        32.67534
                    ],
                    [
                        39.88105,
                        32.6742
                    ],
                    [
                        39.88289,
                        32.66866
                    ],
                    [
                        39.8832,
                        32.66837
                    ],
                    [
                        39.88445,
                        32.66787
                    ],
                    [
                        39.88621,
                        32.66566
                    ],
                    [
                        39.88632,
                        32.66552
                    ],
                    [
                        39.86798,
                        32.63917
                    ],
                    [
                        39.8678,
                        32.63891
                    ],
                    [
                        39.86661,
                        32.63714
                    ],
                    [
                        39.8657,
                        32.63553
                    ],
                    [
                        39.86485,
                        32.63368
                    ],
                    [
                        39.86423,
                        32.63205
                    ],
                    [
                        39.86419,
                        32.63194
                    ],
                    [
                        39.85511,
                        32.607419
                    ],
                    [
                        39.85389,
                        32.604689
                    ],
                    [
                        39.85244,
                        32.60223
                    ],
                    [
                        39.8513,
                        32.60069
                    ],
                    [
                        39.84953,
                        32.59876
                    ],
                    [
                        39.82434,
                        32.57367
                    ],
                    [
                        39.82328,
                        32.572519
                    ],
                    [
                        39.82163,
                        32.5704
                    ],
                    [
                        39.79891,
                        32.53747
                    ],
                    [
                        39.79115,
                        32.526069
                    ],
                    [
                        39.76776,
                        32.484949
                    ],
                    [
                        39.76574,
                        32.48122
                    ],
                    [
                        39.76488,
                        32.479129
                    ],
                    [
                        39.7642,
                        32.47695
                    ],
                    [
                        39.76086,
                        32.46307
                    ],
                    [
                        39.76003,
                        32.46003
                    ],
                    [
                        39.72646,
                        32.361109
                    ],
                    [
                        39.72569,
                        32.358669
                    ],
                    [
                        39.725,
                        32.35607
                    ],
                    [
                        39.72441,
                        32.353279
                    ],
                    [
                        39.71454,
                        32.299259
                    ],
                    [
                        39.71412,
                        32.29731
                    ],
                    [
                        39.71371,
                        32.29585
                    ],
                    [
                        39.71292,
                        32.29361
                    ],
                    [
                        39.71162,
                        32.29079
                    ],
                    [
                        39.70186,
                        32.27089
                    ],
                    [
                        39.70049,
                        32.268389
                    ],
                    [
                        39.69826,
                        32.265009
                    ],
                    [
                        39.68177,
                        32.2411
                    ],
                    [
                        39.68014,
                        32.23901
                    ],
                    [
                        39.67837,
                        32.23725
                    ],
                    [
                        39.6335,
                        32.198749
                    ],
                    [
                        39.62923,
                        32.195169
                    ],
                    [
                        39.62803,
                        32.19433
                    ],
                    [
                        39.62451,
                        32.192149
                    ],
                    [
                        39.59209,
                        32.17249
                    ],
                    [
                        39.59021,
                        32.17116
                    ],
                    [
                        39.58864,
                        32.1697
                    ],
                    [
                        39.58685,
                        32.16755
                    ],
                    [
                        39.58598,
                        32.16626
                    ],
                    [
                        39.58498,
                        32.16447
                    ],
                    [
                        39.58389,
                        32.16182
                    ],
                    [
                        39.58281,
                        32.159689
                    ],
                    [
                        39.57941,
                        32.152119
                    ],
                    [
                        39.57569,
                        32.1435
                    ],
                    [
                        39.57591,
                        32.14342
                    ],
                    [
                        39.57639,
                        32.143279
                    ],
                    [
                        39.5767,
                        32.143929
                    ],
                    [
                        39.57707,
                        32.14474
                    ],
                    [
                        39.57694,
                        32.14485
                    ],
                    [
                        39.57674,
                        32.14494
                    ],
                    [
                        39.57624,
                        32.14477
                    ],
                    [
                        39.57602,
                        32.14485
                    ],
                    [
                        39.576074,
                        32.144965
                    ],
                    [
                        39.57674,
                        32.14631
                    ],
                    [
                        39.5792,
                        32.15203
                    ],
                    [
                        39.58487,
                        32.16462
                    ],
                    [
                        39.58572,
                        32.16614
                    ],
                    [
                        39.58665,
                        32.16755
                    ],
                    [
                        39.58786,
                        32.169069
                    ],
                    [
                        39.58886,
                        32.17014
                    ],
                    [
                        39.59053,
                        32.171619
                    ],
                    [
                        39.59203,
                        32.17268
                    ],
                    [
                        39.62544,
                        32.192929
                    ],
                    [
                        39.62768,
                        32.19431
                    ],
                    [
                        39.62902,
                        32.19525
                    ],
                    [
                        39.63044,
                        32.19637
                    ],
                    [
                        39.67831,
                        32.23744
                    ],
                    [
                        39.67987,
                        32.23897
                    ],
                    [
                        39.68104,
                        32.24037
                    ],
                    [
                        39.68179,
                        32.24141
                    ],
                    [
                        39.69866,
                        32.26589
                    ],
                    [
                        39.70048,
                        32.2687
                    ],
                    [
                        39.70235,
                        32.272239
                    ],
                    [
                        39.71237,
                        32.29271
                    ],
                    [
                        39.71313,
                        32.2946
                    ],
                    [
                        39.71363,
                        32.29609
                    ],
                    [
                        39.71415,
                        32.298099
                    ],
                    [
                        39.71445,
                        32.29961
                    ],
                    [
                        39.72426,
                        32.35335
                    ],
                    [
                        39.72485,
                        32.35611
                    ],
                    [
                        39.72551,
                        32.35861
                    ],
                    [
                        39.72632,
                        32.36119
                    ],
                    [
                        39.75967,
                        32.459429
                    ],
                    [
                        39.7606,
                        32.46268
                    ],
                    [
                        39.76402,
                        32.476869
                    ],
                    [
                        39.76483,
                        32.47945
                    ],
                    [
                        39.76573,
                        32.48158
                    ],
                    [
                        39.76969,
                        32.48868
                    ],
                    [
                        39.79119,
                        32.526449
                    ],
                    [
                        39.80079,
                        32.5405
                    ],
                    [
                        39.8215,
                        32.5705
                    ],
                    [
                        39.82286,
                        32.57228
                    ],
                    [
                        39.82426,
                        32.57383
                    ],
                    [
                        39.84991,
                        32.599379
                    ],
                    [
                        39.85118,
                        32.60081
                    ],
                    [
                        39.85253,
                        32.60266
                    ],
                    [
                        39.85384,
                        32.60492
                    ],
                    [
                        39.85482,
                        32.607129
                    ],
                    [
                        39.86409,
                        32.63215
                    ],
                    [
                        39.86424,
                        32.63253
                    ],
                    [
                        39.865,
                        32.63442
                    ],
                    [
                        39.86591,
                        32.63626
                    ],
                    [
                        39.86783,
                        32.63926
                    ],
                    [
                        39.86799,
                        32.63949
                    ],
                    [
                        39.88817,
                        32.66848
                    ],
                    [
                        39.89029,
                        32.671729
                    ],
                    [
                        39.89239,
                        32.67515
                    ],
                    [
                        39.89239,
                        32.67524
                    ],
                    [
                        39.89455,
                        32.67893
                    ],
                    [
                        39.89457,
                        32.679029
                    ],
                    [
                        39.89459,
                        32.6794
                    ],
                    [
                        39.89447,
                        32.67971
                    ],
                    [
                        39.89115,
                        32.683239
                    ],
                    [
                        39.88709,
                        32.68807
                    ],
                    [
                        39.88355,
                        32.69017
                    ],
                    [
                        39.87919,
                        32.68921
                    ],
                    [
                        39.87864,
                        32.68883
                    ],
                    [
                        39.8774,
                        32.68768
                    ],
                    [
                        39.87673,
                        32.68735
                    ],
                    [
                        39.87601,
                        32.68725
                    ],
                    [
                        39.87541,
                        32.6873
                    ],
                    [
                        39.8738,
                        32.6878
                    ],
                    [
                        39.87382,
                        32.68802
                    ],
                    [
                        39.87399,
                        32.69034
                    ],
                    [
                        39.87342,
                        32.694409
                    ],
                    [
                        39.87335,
                        32.69594
                    ],
                    [
                        39.87346,
                        32.696559
                    ],
                    [
                        39.87377,
                        32.697499
                    ],
                    [
                        39.87469,
                        32.699579
                    ],
                    [
                        39.87458,
                        32.69968
                    ],
                    [
                        39.87387,
                        32.70044
                    ],
                    [
                        39.87165,
                        32.702489
                    ],
                    [
                        39.86946,
                        32.705779
                    ],
                    [
                        39.86732,
                        32.708039
                    ],
                    [
                        39.86588,
                        32.70975
                    ],
                    [
                        39.86576,
                        32.70994
                    ],
                    [
                        39.86504,
                        32.71099
                    ],
                    [
                        39.86464,
                        32.71134
                    ],
                    [
                        39.86412,
                        32.71164
                    ],
                    [
                        39.85729,
                        32.713209
                    ],
                    [
                        39.85671,
                        32.71306
                    ],
                    [
                        39.8504,
                        32.70976
                    ],
                    [
                        39.84775,
                        32.71053
                    ],
                    [
                        39.84675,
                        32.710729
                    ],
                    [
                        39.84475,
                        32.71138
                    ],
                    [
                        39.84214,
                        32.71209
                    ],
                    [
                        39.84212,
                        32.712069
                    ],
                    [
                        39.84199,
                        32.71209
                    ],
                    [
                        39.84198,
                        32.712249
                    ],
                    [
                        39.841878,
                        32.712469
                    ],
                    [
                        39.83397,
                        32.729979
                    ],
                    [
                        39.83343,
                        32.73075
                    ],
                    [
                        39.83099,
                        32.73332
                    ],
                    [
                        39.83026,
                        32.73369
                    ],
                    [
                        39.82933,
                        32.733739
                    ],
                    [
                        39.82935,
                        32.73393
                    ],
                    [
                        39.8294,
                        32.73512
                    ],
                    [
                        39.82864,
                        32.73818
                    ],
                    [
                        39.82854,
                        32.73971
                    ],
                    [
                        39.82836,
                        32.7397
                    ],
                    [
                        39.82762,
                        32.739759
                    ],
                    [
                        39.82736,
                        32.740049
                    ],
                    [
                        39.827331,
                        32.740163
                    ],
                    [
                        39.82712,
                        32.74204
                    ],
                    [
                        39.82715,
                        32.7427
                    ],
                    [
                        39.82732,
                        32.74364
                    ],
                    [
                        39.8283,
                        32.74615
                    ],
                    [
                        39.82902,
                        32.748489
                    ],
                    [
                        39.8298,
                        32.75209
                    ],
                    [
                        39.83044,
                        32.75342
                    ],
                    [
                        39.83066,
                        32.75621
                    ],
                    [
                        39.83056,
                        32.75782
                    ],
                    [
                        39.83061,
                        32.75883
                    ],
                    [
                        39.830408,
                        32.758825
                    ],
                    [
                        39.82681,
                        32.75895
                    ],
                    [
                        39.8252,
                        32.759169
                    ],
                    [
                        39.82374,
                        32.7592
                    ],
                    [
                        39.82353,
                        32.759189
                    ],
                    [
                        39.81862,
                        32.75892
                    ],
                    [
                        39.81826,
                        32.75867
                    ],
                    [
                        39.81809,
                        32.75836
                    ],
                    [
                        39.81813,
                        32.75751
                    ],
                    [
                        39.81804,
                        32.75717
                    ],
                    [
                        39.81774,
                        32.75677
                    ],
                    [
                        39.81748,
                        32.75663
                    ],
                    [
                        39.8161,
                        32.75642
                    ],
                    [
                        39.814,
                        32.75591
                    ],
                    [
                        39.81123,
                        32.7547
                    ],
                    [
                        39.80932,
                        32.754779
                    ],
                    [
                        39.80782,
                        32.75462
                    ],
                    [
                        39.80671,
                        32.75504
                    ],
                    [
                        39.80531,
                        32.75528
                    ],
                    [
                        39.80386,
                        32.75624
                    ],
                    [
                        39.79808,
                        32.75911
                    ],
                    [
                        39.79676,
                        32.7601
                    ],
                    [
                        39.79392,
                        32.762749
                    ],
                    [
                        39.79208,
                        32.76466
                    ],
                    [
                        39.791913,
                        32.764317
                    ],
                    [
                        39.79058,
                        32.7612
                    ],
                    [
                        39.790465,
                        32.760944
                    ],
                    [
                        39.79036,
                        32.76071
                    ],
                    [
                        39.79031,
                        32.76068
                    ],
                    [
                        39.79023,
                        32.76037
                    ],
                    [
                        39.78965,
                        32.758969
                    ],
                    [
                        39.79033,
                        32.758609
                    ],
                    [
                        39.79025,
                        32.758069
                    ],
                    [
                        39.7901,
                        32.75735
                    ],
                    [
                        39.79005,
                        32.75544
                    ],
                    [
                        39.79072,
                        32.752609
                    ],
                    [
                        39.79078,
                        32.75099
                    ],
                    [
                        39.79062,
                        32.749789
                    ],
                    [
                        39.78996,
                        32.74678
                    ],
                    [
                        39.78975,
                        32.74544
                    ],
                    [
                        39.789969,
                        32.74136
                    ]
                ]
            }
        },
        methods: {
            layerChanged(layerId, active) {
                const layer = this.layers.find(layer => layer.id === layerId);

                if (layer.id === 0) {
                    this.locations.forEach((location) => {
                        if (active) {
                            location.leafletMarker.addTo(this.map)
                        } else {
                            location.leafletMarker.removeFrom(this.map)
                        }
                    });
                } else if (layer.id === 1) {
                    if (active) {
                        this.waypointPolyline.addTo(this.map);
                    } else {
                        this.waypointPolyline.removeFrom(this.map);
                    }

                }
            },
            initObjects() {
                this.locations.forEach((location) => {
                    location.leafletMarker = L.marker(location.location, {icon: this.blackMarker, data: location})
                        .bindTooltip('<p>' + location.title + '</p>')
                        .on('click', this.onMarkerClick);
                });

                this.waypointPolyline = L.polyline(this.waypoints);
            },
            initMap() {
                this.map = L.map('voyage_map').setView([39.918836, 32.836816], this.zoomLevel);

                this.tileLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="http://team9.bilkent.edu.tr/">MANERP</a>, &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                }).addTo(this.map);


                this.tileLayer.addTo(this.map);

                // get current location
                navigator.geolocation.getCurrentPosition(location => {
                    let pos = new L.LatLng(location.coords.latitude, location.coords.longitude);
                    this.map.setView(pos, this.zoomLevel);
                    L.marker(pos, {icon: this.greenMarker}).addTo(this.map);
                });
            },
            initIcons() {
                const shadow = require('@/assets/leaflet/icons/marker-shadow.png');

                const greenIcon = require('@/assets/leaflet/icons/marker-icon-2x-green.png');
                this.greenMarker = new L.Icon({
                    iconUrl: greenIcon,
                    shadowUrl: shadow,
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                });

                const blackIcon = require('@/assets/leaflet/icons/marker-icon-2x-black.png');
                this.blackMarker = new L.Icon({
                    iconUrl: blackIcon,
                    shadowUrl: shadow,
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                });

            },
            save() {

            },
            getLayers() {
                return this.layers;
            },
            setLocations(locations) {
                this.locations = locations;
                this.initObjects();
            },
            onMarkerClick(e) {

            }
        },
        mounted() {
            this.initIcons();
            this.initMap();
            this.initObjects();
        }
    }
</script>

<style scoped>

</style>